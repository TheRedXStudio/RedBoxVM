<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - RedBoxVM Documentation</title>
    <meta name="description" content="Complete API documentation with code examples, method signatures, and integration patterns for RedBoxVM.">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/docs.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../assets/icons/favicon.svg">
    
    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav" id="nav">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="../assets/icons/favicon.svg" alt="RedBoxVM" class="nav-logo" style="width: 48px; height: 48px;" />
                <span class="nav-title" style="color: white;">RedBoxVM</span>
            </div>

            <div class="nav-menu" id="nav-menu">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="../index.html#features" class="nav-link">Features</a>
                <a href="../index.html#architecture" class="nav-link">Architecture</a>
                <a href="getting-started.html" class="nav-link active">Documentation</a>
                <a href="../index.html#download" class="nav-link">Download</a>
            </div>

            <div class="nav-actions">
                <button class="theme-toggle" id="theme-toggle" title="Toggle dark/light mode">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <line x1="12" y1="1" x2="12" y2="3" />
                        <line x1="12" y1="21" x2="12" y2="23" />
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                        <line x1="1" y1="12" x2="3" y2="12" />
                        <line x1="21" y1="12" x2="23" y2="12" />
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </button>
                <a href="https://github.com/TheRedXStudio/RedBoxVM" class="nav-github" target="_blank" rel="noopener">
                    <img src="../assets/icons/favicon.svg" alt="RedBoxVM" style="width: 24px; height: 24px;" />
                </a>
            </div>
        </div>
    </nav>

    <!-- Documentation Container -->
    <div class="docs-container">
        <!-- Sidebar Navigation -->
        <aside class="docs-sidebar">
            <h3 class="docs-nav-title">Documentation</h3>
            <nav class="docs-nav">
                <ul>
                    <li class="docs-nav-item">
                        <a href="getting-started.html" class="docs-nav-link">Getting Started</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="architecture.html" class="docs-nav-link">Architecture</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="api-reference.html" class="docs-nav-link active">API Reference</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="security.html" class="docs-nav-link">Security Guide</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="build-guide.html" class="docs-nav-link">Build Guide</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="examples.html" class="docs-nav-link">Examples</a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="docs-content">
            <div class="docs-breadcrumb">
                <a href="../index.html">Home</a>
                <span class="docs-breadcrumb-separator">/</span>
                <a href="getting-started.html">Documentation</a>
                <span class="docs-breadcrumb-separator">/</span>
                <span>API Reference</span>
            </div>

            <h1>RedBoxVM API Reference</h1>
            
            <p>Complete API documentation for integrating RedBoxVM into your applications. This reference covers all public APIs, interfaces, and integration patterns.</p>

            <div class="alert alert-info">
                <strong>SDK Version:</strong> This documentation covers RedBoxVM SDK v2.1.0 and later.
            </div>

            <h2>Core Classes</h2>

            <h3>LazyVMCore</h3>
            
            <p>The main entry point for all RedBoxVM operations and virtualization management.</p>

            <pre><code>public class LazyVMCore extends ClientConfiguration {
    // Singleton instance
    public static LazyVMCore get()
    
    // Get application context
    public static Context getContext()
    
    // Get package manager
    public static PackageManager getPackageManager()
    
    // Get host package name
    public static String getHostPkg()
    
    // Get host UID
    public static int getHostUid()
    
    // Get host user ID
    public static int getHostUserId()
    
    // Check if services are available
    public boolean areServicesAvailable()
    
    // Get system service binder
    public IBinder getService(String name)
    
    // Enhanced UID management
    public void setCurrentAppUid(int uid, String packageName)
    public int getCurrentAppUid()
    public String getCurrentAppPackage()
    public boolean isSandboxedEnvironment()
}</code></pre>

            <h4>Usage Example</h4>

            <pre><code>// Get LazyVMCore instance
LazyVMCore core = LazyVMCore.get();

// Get application context
Context context = LazyVMCore.getContext();

// Get host package information
String hostPkg = LazyVMCore.getHostPkg();
int hostUid = LazyVMCore.getHostUid();

// Set current virtual app information
core.setCurrentAppUid(10123, "com.whatsapp");

// Check if running in sandboxed environment
if (core.isSandboxedEnvironment()) {
    Log.d("RedBox", "Running in virtual environment for: " + core.getCurrentAppPackage());
}</code></pre>

            <h3>NativeCore</h3>
            
            <p>Native operations and low-level virtualization controls.</p>

            <pre><code>public class NativeCore {
    // Initialize native core with API level
    public static native void init(int apiLevel)
    
    // Enable I/O redirection
    public static native void enableIO()
    
    // Add I/O redirection rule
    public static native void addIORule(String targetPath, String relocatePath)
    
    // Hide Xposed framework
    public static native void hideXposed()
    
    // Disable hidden API restrictions
    public static native boolean disableHiddenApi()
    
    // System properties management
    public static native void nativeSetProp(String key, String value)
    public static native String nativeGetProp(String key)
    public static native void nativeClearProps()
    
    // Dynamic configuration
    public static native void setHostPackageName(String packageName)
    public static native void setVirtualAppInfo(String packageName, int processId, int userId)
    public static native String getHostPackageName()
    public static native String getVirtualPackageName()
    public static native boolean isHostProcess()
    public static native boolean isVirtualProcess()
    
    // Network virtualization
    public static native void enableNativeSSLBypass(boolean enable)
    public static native void enableNativeNetworkVirtualization(boolean enable)
    public static native void setNetworkInterface(String interfaceName, String macAddress, String ipAddress)
    
    // Authentication system
    public static native boolean initializeAuth()
    public static native boolean setClientLicense(String licenseKey)
    public static native boolean checkAuthStatus()
    public static native boolean checkAuthStatusForPackage(String packageName)
}</code></pre>

            <h3>BActivityThread</h3>
            
            <p>Virtual activity thread management for app lifecycle control.</p>

            <pre><code>public class BActivityThread {
    // Get current virtual activity thread
    public static BActivityThread currentActivityThread()
    
    // Get application context
    public Application getApplication()
    
    // Get system context
    public Context getSystemContext()
    
    // Install virtual application
    public void installApplication(ApplicationInfo appInfo)
    
    // Handle virtual app lifecycle
    public void handleBindApplication(AppBindData data)
    
    // Process virtual app commands
    public void scheduleTransaction(ClientTransaction transaction)
}</code></pre>

            <h2>Framework Classes</h2>

            <h3>BPackageManager</h3>
            
            <p>Virtual package manager for handling app installations and queries.</p>

            <pre><code>public class BPackageManager {
    // Get virtual package manager instance
    public static BPackageManager get()
    
    // Install virtual application
    public InstallResult installPackage(String apkPath, InstallOption option)
    
    // Uninstall virtual application
    public boolean uninstallPackage(String packageName)
    
    // Get installed virtual packages
    public List&lt;PackageInfo&gt; getInstalledPackages(int flags)
    
    // Get package information
    public PackageInfo getPackageInfo(String packageName, int flags)
    
    // Get application information
    public ApplicationInfo getApplicationInfo(String packageName, int flags)
    
    // Check if package is installed
    public boolean isPackageInstalled(String packageName)
}</code></pre>

            <h3>BUserManager</h3>
            
            <p>Virtual user management for multi-user virtualization.</p>

            <pre><code>public class BUserManager {
    // Get virtual user manager instance
    public static BUserManager get()
    
    // Create virtual user
    public BUserInfo createUser(String name, int flags)
    
    // Remove virtual user
    public boolean removeUser(int userId)
    
    // Get all virtual users
    public List&lt;BUserInfo&gt; getUsers()
    
    // Get current virtual user
    public BUserInfo getCurrentUser()
    
    // Switch to virtual user
    public boolean switchUser(int userId)
}</code></pre>

            <h4>Implementation Example</h4>

            <pre><code>// Install virtual app
BPackageManager pm = BPackageManager.get();
InstallOption option = new InstallOption();
option.userId = 0;
option.installFlags = PackageManager.INSTALL_REPLACE_EXISTING;

InstallResult result = pm.installPackage("/path/to/app.apk", option);
if (result.isSuccess()) {
    Log.d("RedBox", "App installed successfully: " + result.packageName);
} else {
    Log.e("RedBox", "Installation failed: " + result.error);
}

// Create virtual user
BUserManager um = BUserManager.get();
BUserInfo user = um.createUser("Virtual User 1", 0);
if (user != null) {
    Log.d("RedBox", "Created virtual user: " + user.name + " with ID: " + user.id);
}</code></pre>

            <h2>API Flow Diagram</h2>
            
            <p>Understanding the typical API usage flow:</p>

            <div class="mermaid">
sequenceDiagram
    participant App as Your App
    participant Core as LazyVMCore
    participant Native as NativeCore
    participant PM as BPackageManager
    participant AT as BActivityThread
    
    App->>Core: LazyVMCore.get()
    App->>Native: NativeCore.init(apiLevel)
    Native->>Native: Initialize Hooks & I/O
    
    App->>PM: BPackageManager.get()
    App->>PM: installPackage(apkPath, option)
    PM->>Native: addIORule(targetPath, relocatePath)
    PM->>App: Return InstallResult
    
    App->>AT: BActivityThread.currentActivityThread()
    AT->>Native: setVirtualAppInfo(pkg, pid, uid)
    AT->>Core: Launch Virtual App Process
    Core->>App: Virtual App Running
            </div>

            <h2>Advanced APIs</h2>

            <h3>IOCore</h3>
            
            <p>File system virtualization and I/O redirection management.</p>

            <pre><code>public class IOCore {
    // Get IOCore instance
    public static IOCore get()
    
    // Redirect file path
    public String redirectPath(String path)
    public File redirectPath(File path)
    
    // Add I/O redirection rule
    public void addRule(String targetPath, String relocatePath)
    
    // Enable I/O redirection
    public void enable()
    
    // Get virtual file system root
    public String getVirtualRoot()
    
    // Check if path is redirected
    public boolean isRedirected(String path)
}</code></pre>

            <h3>BEnvironment</h3>
            
            <p>Virtual environment management and configuration.</p>

            <pre><code>public class BEnvironment {
    // Get virtual environment for user
    public static BEnvironment getVirtualEnvironment(int userId)
    
    // Get external storage directory
    public File getExternalStorageDirectory()
    
    // Get data directory for package
    public File getDataDirectory(String packageName)
    
    // Get cache directory for package
    public File getCacheDirectory(String packageName)
    
    // Get virtual system directory
    public File getSystemDirectory()
    
    // Check if environment is initialized
    public boolean isInitialized()
}</code></pre>

            <h3>ServiceManager</h3>
            
            <p>Virtual system service management.</p>

            <pre><code>public class ServiceManager {
    // Get virtual service by name
    public static IBinder getService(String name)
    
    // Add virtual service
    public static void addService(String name, IBinder service)
    
    // Remove virtual service
    public static void removeService(String name)
    
    // List all virtual services
    public static String[] listServices()
    
    // Check if service exists
    public static boolean checkService(String name)
}</code></pre>

            <h2>Error Handling</h2>

            <h3>Exception Types</h3>

            <table>
                <thead>
                    <tr>
                        <th>Exception</th>
                        <th>Description</th>
                        <th>Common Causes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>RuntimeException</td>
                        <td>General runtime error in virtualization</td>
                        <td>Native core not initialized, hook installation failed</td>
                    </tr>
                    <tr>
                        <td>SecurityException</td>
                        <td>Security or permission error</td>
                        <td>Insufficient permissions, authentication failed</td>
                    </tr>
                    <tr>
                        <td>IllegalStateException</td>
                        <td>Invalid virtualization state</td>
                        <td>Services not available, invalid process state</td>
                    </tr>
                    <tr>
                        <td>UnsupportedOperationException</td>
                        <td>Operation not supported</td>
                        <td>Unsupported Android version, missing native library</td>
                    </tr>
                </tbody>
            </table>

            <h3>Error Handling Example</h3>

            <pre><code>try {
    // Initialize LazyVM core
    LazyVMCore core = LazyVMCore.get();
    NativeCore.init(Build.VERSION.SDK_INT);
    
    // Install virtual app
    BPackageManager pm = BPackageManager.get();
    InstallResult result = pm.installPackage("/path/to/app.apk", new InstallOption());
    
    if (!result.isSuccess()) {
        throw new RuntimeException("Installation failed: " + result.error);
    }
    
} catch (SecurityException e) {
    Log.e("RedBox", "Security error", e);
    // Handle authentication or permission issues
    if (!NativeCore.checkAuthStatus()) {
        showAuthenticationDialog();
    }
    
} catch (IllegalStateException e) {
    Log.e("RedBox", "Invalid state error", e);
    // Handle service availability issues
    if (!core.areServicesAvailable()) {
        showServiceUnavailableMessage();
    }
    
} catch (Exception e) {
    Log.e("RedBox", "Unexpected error", e);
    // Handle unexpected errors
    Slog.e("RedBox", "Critical error in virtualization", e);
}</code></pre>

            <h2>Configuration Options</h2>

            <h3>ClientConfiguration</h3>

            <pre><code>public class ClientConfiguration {
    // Host package name
    public String getHostPackageName()
    
    // Virtual app package name
    public String getAppPackageName()
    
    // Process type (Main, BlackDaemon, etc.)
    public ProcessType getProcessType()
    
    // Enable debugging features
    public boolean isDebugMode()
    
    // Get configuration for specific package
    public AppConfig getAppConfig(String packageName)
}</code></pre>

            <h3>InstallOption</h3>

            <pre><code>public class InstallOption {
    // Target user ID for installation
    public int userId = 0;
    
    // Installation flags
    public int installFlags = 0;
    
    // Custom data directory
    public String customDataDir = null;
    
    // Enable external storage
    public boolean enableExternalStorage = true;
    
    // Copy APK to virtual environment
    public boolean copyApk = true;
    
    // Skip signature verification
    public boolean skipVerification = false;
}</code></pre>

            <h3>System Properties Configuration</h3>

            <pre><code>// Set system property for virtual environment
NativeCore.nativeSetProp("ro.build.version.release", "13");
NativeCore.nativeSetProp("ro.product.model", "Virtual Device");

// Get system property
String androidVersion = NativeCore.nativeGetProp("ro.build.version.release");

// Clear all custom properties
NativeCore.nativeClearProps();

// Network interface configuration
NativeCore.setNetworkInterface("wlan0", "02:00:00:00:00:00", "192.168.1.100");

// Enable SSL bypass for debugging
NativeCore.enableNativeSSLBypass(true);

// Enable network virtualization
NativeCore.enableNativeNetworkVirtualization(true);</code></pre>

            <h2>Performance Monitoring</h2>

            <h3>StealthMemoryReader</h3>

            <pre><code>public class StealthMemoryReader {
    // Initialize stealth memory system
    public static boolean initialize()
    
    // Shutdown stealth memory system
    public static boolean shutdown()
    
    // Check if system is healthy
    public static boolean isReady()
    
    // Read memory from target process
    public byte[] readMemory(int pid, long address, int size)
    
    // Write memory to target process
    public boolean writeMemory(int pid, long address, byte[] data)
}</code></pre>

            <h3>Performance Utilities</h3>

            <pre><code>// Initialize stealth memory system
if (NativeCore.initializeStealthMemorySystem()) {
    Log.d("RedBox", "Stealth memory system initialized");
} else {
    Log.w("RedBox", "Failed to initialize stealth memory system");
}

// Check system health
boolean isHealthy = NativeCore.isStealthMemorySystemHealthy();
Log.d("RedBox", "Memory system health: " + isHealthy);

// Monitor virtual app performance
LazyVMCore core = LazyVMCore.get();
if (core.isSandboxedEnvironment()) {
    String currentApp = core.getCurrentAppPackage();
    int currentUid = core.getCurrentAppUid();
    Log.d("RedBox", "Monitoring app: " + currentApp + " (UID: " + currentUid + ")");
}

// Shutdown when done
NativeCore.shutdownStealthMemorySystem();</code></pre>

            <h3>Process Information</h3>

            <pre><code>// Check process type
if (NativeCore.isHostProcess()) {
    Log.d("RedBox", "Running in host process");
} else if (NativeCore.isVirtualProcess()) {
    Log.d("RedBox", "Running in virtual process");
    String virtualPkg = NativeCore.getVirtualPackageName();
    Log.d("RedBox", "Virtual package: " + virtualPkg);
}

// Get host information
String hostPkg = NativeCore.getHostPackageName();
Log.d("RedBox", "Host package: " + hostPkg);</code></pre>

            <h2>Integration Patterns</h2>

            <h3>Singleton Pattern</h3>

            <pre><code>public class MyRedBoxIntegration {
    private static MyRedBoxIntegration instance;
    private LazyVMCore lazyVMCore;
    
    private MyRedBoxIntegration() {
        lazyVMCore = LazyVMCore.get();
        // Initialize native core
        NativeCore.init(Build.VERSION.SDK_INT);
    }
    
    public static MyRedBoxIntegration getInstance() {
        if (instance == null) {
            synchronized (MyRedBoxIntegration.class) {
                if (instance == null) {
                    instance = new MyRedBoxIntegration();
                }
            }
        }
        return instance;
    }
    
    public LazyVMCore getCore() {
        return lazyVMCore;
    }
}</code></pre>

            <h3>Virtual App Management Pattern</h3>

            <pre><code>public class VirtualAppManager {
    private final LazyVMCore core;
    private final BPackageManager packageManager;
    private final Map&lt;String, InstallResult&gt; installedApps;
    
    public VirtualAppManager() {
        core = LazyVMCore.get();
        packageManager = BPackageManager.get();
        installedApps = new HashMap&lt;&gt;();
    }
    
    public boolean installApp(String apkPath, String packageName) {
        try {
            InstallOption option = new InstallOption();
            option.userId = 0;
            option.copyApk = true;
            
            InstallResult result = packageManager.installPackage(apkPath, option);
            if (result.isSuccess()) {
                installedApps.put(packageName, result);
                Log.d("RedBox", "Successfully installed: " + packageName);
                return true;
            } else {
                Log.e("RedBox", "Installation failed: " + result.error);
                return false;
            }
        } catch (Exception e) {
            Log.e("RedBox", "Error installing app: " + packageName, e);
            return false;
        }
    }
    
    public boolean isAppInstalled(String packageName) {
        return packageManager.isPackageInstalled(packageName);
    }
    
    public List&lt;PackageInfo&gt; getInstalledApps() {
        return packageManager.getInstalledPackages(0);
    }
}</code></pre>

            <div class="alert alert-warning">
                <strong>Thread Safety:</strong> LazyVMCore and NativeCore APIs are thread-safe, but package installation and I/O operations should be performed on background threads to avoid blocking the UI.
            </div>

            <h2>Authentication System</h2>

            <h3>License Management</h3>

            <pre><code>// Initialize authentication system
if (NativeCore.initializeAuth()) {
    Log.d("RedBox", "Authentication system initialized");
    
    // Set client license
    String licenseKey = "your-license-key-here";
    if (NativeCore.setClientLicense(licenseKey)) {
        Log.d("RedBox", "License validated successfully");
    } else {
        Log.e("RedBox", "License validation failed");
    }
} else {
    Log.e("RedBox", "Failed to initialize authentication");
}

// Check authentication status
boolean isAuthenticated = NativeCore.checkAuthStatus();
if (isAuthenticated) {
    Log.d("RedBox", "Client is authenticated");
} else {
    Log.w("RedBox", "Client authentication required");
}

// Check authentication for specific package
boolean canRunPackage = NativeCore.checkAuthStatusForPackage("com.example.app");
if (!canRunPackage) {
    Log.w("RedBox", "Package is not authorized to run");
}</code></pre>

            <!-- Navigation -->
            <div class="docs-navigation">
                <a href="architecture.html" class="docs-nav-btn">
                    ← Architecture Guide
                </a>
                <a href="security.html" class="docs-nav-btn">
                    Security Guide →
                </a>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/docs.js"></script>
</body>

</html>